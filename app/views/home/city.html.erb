<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style type="text/css">
  #map_home_canvas { height: 325px ; width: 620px;}
</style>
<style type="text/css">
  .string{margin-left: -80px;}
  .select{margin-left: -80px;}
</style>
<script type="text/javascript"
        src="http://maps.googleapis.com/maps/api/js?key=AIzaSyBaz4HYWs-2If2J6Awpc23Twds3i-1Mj88&sensor=true">
</script>
<script type="text/javascript">
  function initialize() {
    var latlo = new google.maps.LatLng(<%= @city.latitude rescue nil %>, <%= @city.longitude rescue nil%>);
    var myOptions = {
      center: latlo,
      zoom: 12,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("map_home_canvas"), myOptions);

    var bar = [];
<% Bar.where(city: @city.name).each do |b| %>
      var x = [];
      x.push(<%= b.latitude %>);
      x.push(<%= b.longitude %>);
      x.push('<%= link_to  b.name, bar_profile_users_path(b) %>');
      bar.push(x);
<% end %>

    function addInfoWindow(marker, newMarker){
      var infowindow = new google.maps.InfoWindow({
        content: newMarker.info
      });

      google.maps.event.addListener(marker, 'click', function() {
        infowindow.open(map,marker);
      });
    }

    var infowindow = new google.maps.InfoWindow();

    for (var i = 0; i < bar.length; i++) {
      var marker = new google.maps.Marker({
        position: new google.maps.LatLng(bar[i][0], bar[i][1]),
        map: map
      });

      var htmlcontent = '<div style="height: 120;width: 120px;border-radius: 5px"><b>'+bar[i][2]+'</b>'+
        '<br/>'+bar[i][3]+'</div>';

      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          infowindow.setContent('<b>'+bar[i][2]+'</b>'+'<br/>'+bar[i][3]);
          /*infowindow.setContent('<div style="height: 120;width: 170px;border-radius: 5px;margin-top: -10px;margin-bottom: -10px;">'+
            '<br/>'+
            '<ul class="tabs" data-tabs="tabs">'+
            '<li class="active"><a href="#cover" data-toggle="tab"><b>'+bar[i][2]+'</b></a></li>'+
            '<li><a href="#detail" data-toggle="tab"><b>Detail</b></a></li>'+
            '</ul>'+
            '<div id="my-tab-content" class="tab-content">'+
            '<div class="tab-pane active" id="cover">'+
            bar[i][3]+
            '</div>'+
            '<div class="tab-pane" id="detail">'+
            'detail</div>'+
            '</div>'+
            '</div>');*/
          infowindow.open(map, marker);
        }
      })(marker, i));
    }

  }
</script>

<body onload="initialize()">


  <%= content_for :side do %>
    <h4><%= @city.name.titleize %></h4>
    <ul>
      <li id="fat-menu" class="dropdown" style="list-style: none;">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><b>Select City</b></a>
        <ul class="dropdown-menu">
          <% City.order(:name).each do |c| %>
            <li>
              <%= link_to c.name, city_home_path(c), method: :get %>
            </li>
          <% end %>
        </ul>
      </li>
    </ul>
    <%= simple_form_for(@search, url: city_home_path) do |f|%>
      <div class="accordion-group">
        <div class="accordion-heading" style="margin-left: 10px;">
          <div class="accordion-inner">
            <a class="" data-toggle="collapse" data-target="#search" style="color: black;"><b>Narrow it down</b></a>
          </div>
        </div>
      </div>
      <!--<div id="search" class="accordion-body collapse">-->
        <div class="accordion-inner" style="margin-left: 0px;">
          <%= f.input :bar_zip_code_contains, label: false, placeholder: "Zip Code", required: false, input_html: {style: "width: 100px;"} %>
          <b style="margin-left: 60px;">Radius in Mile</b>
          <%= select(:geo, :radius,  radius_collection, {:include_blank => true}) %>
          <br/>
          <br/>
          <b style="margin-left: 60px;">Swig Type</b>
          <%= f.input :swig_type_contains,label: false, as: :select, collection: [["Standard","Standard"],["Big","Big"]], placeholder: "Search by Type",required: false %>
          <b style="margin-left: 60px;">Sports teams</b>
          <%= f.input :bar_sports_team_contains,as: :select, label: false, collection: sport_teams_collection, placeholder: "Sports Team",required: false %>
          <%= f.submit "Search", class: "btn-mini btn-primary pull-right" %>
          </div>
        <!--</div>-->
      <% end %>
    <% end %>

    <div class="clearfix"></div>
    <div class="clearfix"></div>

    <ul class="tabs" data-tabs="tabs">
      <li><a href="#list" data-toggle="tab"><h3>List</h3></a></li>
      <li class="active"><a href="#map" data-toggle="tab"><h3>Map</h3></a></li>
      <!--<li><a href="#reward" data-toggle="tab"><h3>Reward</h3></a></li>-->
    </ul>

    <div id="my-tab-content" class="tab-content">
      <div class="tab-pane active" id="map"><!-----bar map------>
        <div id="map_home_canvas">
  <%#= image_tag("http://maps.googleapis.com/maps/api/js?key=AIzaSyBaz4HYWs-2If2J6Awpc23Twds3i-1Mj88") %>
        </div>
      </div>

      <div class="tab-pane" id="list"><!-----list of swig------>
        <table class="zebra-striped">
          <th>Deals</th>
          <th>swigBIG Deals</th>
          <th>Bar Name</th>
          <th>Distance</th>
          <% @swigs.each do |swig| %>
            <tr>
              <td>
                <b class="pull-left"><%= link_to  truncate(swig.deal, length: 30), bar_profile_users_path(swig.bar), input_html: {rel: "popover", title: swig.deal.to_s} %></b>
                <a href="#" id="popover" class="btn btn-danger" rel="popover" title="A Title" data-content="And here's some amazing content. It's very engaging. right?">hover for popover</a>
              </td>
              <td>
                <% if  swig.swig_type.eql?("Big") %>
                  <button class="btn-warning" style="padding-bottom: 3px;padding-left: 3px;padding-right: 3px;padding-top: 3px;">
                    <%= swig.swig_type %>
                  </button>
                  <b>Required: </b><%= swig.people %> people
                <% else %>
                  <button class="btn-primary" style="padding-bottom: 3px;padding-left: 3px;padding-right: 3px;padding-top: 3px;">
                    <%= swig.swig_type %>
                  </button>
                <% end %>
              </td>
              <td>
                <b><%= link_to  swig.bar.name, bar_profile_users_path(swig.bar) %></b>
              </td>
              <td>
                <%=begin
                  sprintf("%.2f",Geocoder::Calculations.distance_between([@city.latitude,@city.longitude], [swig.latitude, swig.longitude]))
                rescue
                end %> miles
              </td>
            </tr>
          <% end %>
        </table>
      </div>

    </div>


